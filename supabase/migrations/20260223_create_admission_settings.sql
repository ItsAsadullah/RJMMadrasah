-- Admission ржкрзЗржЬрзЗрж░ рж╕рзЗржЯрж┐ржВрж╕ ржЯрзЗржмрж┐рж▓
CREATE TABLE IF NOT EXISTS admission_settings (
  id bigint PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
  -- рж╣рж┐рж░рзЛ рж╕рзЗржХрж╢ржи
  hero_year text NOT NULL DEFAULT 'рж╢рж┐ржХрзНрж╖рж╛ржмрж░рзНрж╖ рзирзжрзирзм',
  hero_subtitle text NOT NULL DEFAULT 'рж░рж╣рж┐ржорж╛ ржЬрж╛ржирзНржирж╛ржд ржорж╣рж┐рж▓рж╛ ржорж╛ржжрзНрж░рж╛рж╕рж╛ржпрж╝ ржирждрзБржи рж╢рж┐ржХрзНрж╖рж╛ржмрж░рзНрж╖рзЗ ржирзВрж░рж╛ржирзА, ржирж╛ржЬрзЗрж░рж╛, рж╣рж┐ржлржЬ ржУ ржХрж┐рждрж╛ржм ржмрж┐ржнрж╛ржЧрзЗ ржнрж░рзНрждрж┐ ржЪрж▓ржЫрзЗред',
  hero_badge text NOT NULL DEFAULT 'ржнрж░рзНрждрж┐ ржЪрж▓ржЫрзЗ',
  -- ржорж╛рж░рзНржХрж┐ ржирзЛржЯрж┐рж╕
  marquee_text text NOT NULL DEFAULT 'ЁЯУв рж╕рзАржорж┐ржд ржЖрж╕ржи рж╕ржВржЦрзНржпрж╛! ржжрзНрж░рзБржд ржЖржкржирж╛рж░ рж╕ржирзНрждрж╛ржирзЗрж░ ржнрж░рзНрждрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржиред ржмрж┐рж╢рзЗрж╖ ржкрзНрж░ржпрж╝рзЛржЬржирзЗ ржпрзЛржЧрж╛ржпрзЛржЧ ржХрж░рзБржи: рзжрззрзнXX-XXXXXX',
  -- ржнрж░рзНрждрж┐рж░ рж╢рж░рзНрждрж╛ржмрж▓рзА (JSON array of strings)
  requirements jsonb NOT NULL DEFAULT '[
    "ржЬржирзНржо ржирж┐ржмржирзНржзржи рж╕ржиржжрзЗрж░ ржлржЯрзЛржХржкрж┐ (ржмрж╛ржзрзНржпрждрж╛ржорзВрж▓ржХ)",
    "рж╢рж┐ржХрзНрж╖рж╛рж░рзНржерзАрж░ рзи ржХржкрж┐ ржкрж╛рж╕ржкрзЛрж░рзНржЯ рж╕рж╛ржЗржЬрзЗрж░ рж░ржЩрж┐ржи ржЫржмрж┐",
    "ржкрж┐рждрж╛/ржорж╛рждрж╛рж░ ржПржиржЖржЗржбрж┐ ржХрж╛рж░рзНржбрзЗрж░ ржлржЯрзЛржХржкрж┐",
    "ржЖржЧрзЗрж░ ржорж╛ржжрзНрж░рж╛рж╕рж╛рж░ ржЫрж╛ржбрж╝ржкрждрзНрж░ (ржпржжрж┐ ржерж╛ржХрзЗ)",
    "ржирж┐рж░рзНржзрж╛рж░рж┐ржд ржнрж░рзНрждрж┐ ржлрж░ржо ржкрзВрж░ржг ржУ ржлрж┐ ржкрзНрж░ржжрж╛ржи"
  ]'::jsonb,
  -- ржлрж┐ рждрж╛рж▓рж┐ржХрж╛ (JSON array of {class, admission_fee, monthly_fee})
  fee_rows jsonb NOT NULL DEFAULT '[
    {"class": "ржирзВрж░рж╛ржирзА (рж╢рж┐рж╢рзБ - рзйржпрж╝)", "admission_fee": "рзйрзжрзжрзж", "monthly_fee": "рзорзжрзж"},
    {"class": "рж╣рж┐ржлржЬрзБрж▓ ржХрзБрж░ржЖржи", "admission_fee": "рзлрзжрзжрзж", "monthly_fee": "рззрзлрзжрзж"},
    {"class": "ржХрж┐рждрж╛ржм ржмрж┐ржнрж╛ржЧ", "admission_fee": "рзкрзжрзжрзж", "monthly_fee": "рззрзирзжрзж"},
    {"class": "ржЖржмрж╛рж╕рж┐ржХ ржЪрж╛рж░рзНржЬ", "admission_fee": "рзирзжрзжрзж", "monthly_fee": "рзирзлрзжрзж"}
  ]'::jsonb,
  fee_note text NOT NULL DEFAULT '* ржПрждрж┐ржо ржУ ржЧрж░рж┐ржм рж╢рж┐ржХрзНрж╖рж╛рж░рзНржерзАржжрзЗрж░ ржЬржирзНржп ржмрж┐рж╢рзЗрж╖ ржЫрж╛ржбрж╝рзЗрж░ ржмрзНржпржмрж╕рзНржерж╛ рж░ржпрж╝рзЗржЫрзЗред',
  -- ржмрж┐ржнрж╛ржЧрж╕ржорзВрж╣ (JSON array of {title, desc})
  departments jsonb NOT NULL DEFAULT '[
    {"title": "ржирзВрж░рж╛ржирзА ржУ ржоржХрзНрждржм", "desc": "рж╢рж┐рж╢рзБржжрзЗрж░ ржЬржирзНржп ржмрзБржирж┐ржпрж╝рж╛ржжрж┐ рж╢рж┐ржХрзНрж╖рж╛ ржУ рж╕рж╣рзАрж╣ ржХрзБрж░ржЖржи рждрзЗрж▓рж╛ржУржпрж╝рж╛рждред"},
    {"title": "рж╣рж┐ржлржЬрзБрж▓ ржХрзБрж░ржЖржи", "desc": "ржЕржнрж┐ржЬрзНржЮ рж╣рж╛ржлрзЗржЬ ржжрзНржмрж╛рж░рж╛ рзй ржмржЫрж░рзЗ рж╕ржорзНржкрзВрж░рзНржг ржХрзБрж░ржЖржи рж╣рж┐ржлржЬред"},
    {"title": "ржХрж┐рждрж╛ржм ржмрж┐ржнрж╛ржЧ", "desc": "ржорж┐ржЬрж╛ржи ржерзЗржХрзЗ ржжрж╛ржУрж░рж╛ржпрж╝рзЗ рж╣рж╛ржжрж┐рж╕ ржкрж░рзНржпржирзНржд ржЧржнрзАрж░ ржжрзНржмрзАржирж┐ рж╢рж┐ржХрзНрж╖рж╛ред"}
  ]'::jsonb,
  -- ржирж┐ржЪрзЗрж░ CTA рж╕рзЗржХрж╢ржи
  cta_title text NOT NULL DEFAULT 'ржЖржкржирж╛рж░ рж╕ржирзНрждрж╛ржирзЗрж░ ржЙржЬрзНржЬрзНржмрж▓ ржнржмрж┐рж╖рзНржпрждрзЗрж░ ржЬржирзНржп ржЖржЬржЗ ржпрзЛржЧрж╛ржпрзЛржЧ ржХрж░рзБржи',
  cta_phone text NOT NULL DEFAULT 'рзжрззрзпрзорзорзирззрзкрзлрзлрзк',
  cta_address text NOT NULL DEFAULT 'рж╣рж▓рж┐ржзрж╛ржирзА ржмрж╛ржЬрж╛рж░, ржЭрж┐ржирж╛ржЗржжрж╣ рж╕ржжрж░',
  updated_at timestamptz DEFAULT now()
);

ALTER TABLE admission_settings ENABLE ROW LEVEL SECURITY;

CREATE POLICY "admission_settings_public_read" ON admission_settings
  FOR SELECT USING (true);

CREATE POLICY "admission_settings_admin_write" ON admission_settings
  FOR ALL USING (auth.role() = 'authenticated');

INSERT INTO admission_settings DEFAULT VALUES ON CONFLICT DO NOTHING;
